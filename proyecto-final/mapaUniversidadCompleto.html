<!DOCTYPE html>
<html>
<head>
    <title>Maps</title>
    <meta charset="UTF-8">

    <style>
        #map {
            height: 600px;
            width: 800px;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    // map coordinates
    const UAOcoordenates = {lat: 16.9956106, lng: -96.7527389};

    
    // important places coordinates
    const F_building = {lat: 16.996552, lng: -96.75321}; // 0
    const cuckoo_box = {lat: 16.996448, lng: -96.753507}; // 1
    const dely_full = {lat: 16.996173, lng: -96.753432}; // 2
    const C_building = {lat: 16.996179, lng: -96.752994}; // 3
    const west_path = {lat: 16.996322, lng: -96.752720}; // 4
    const roundabout = {lat: 16.996348, lng: -96.752477}; // 5
    const police_booth = {lat: 16.996818, lng: -96.752471}; // 6
    const chess_board = {lat: 16.996357, lng: -96.752250}; // 7
    const A_building = {lat: 16.996576, lng: -96.751936}; // 8
    const B_building = {lat: 16.996348, lng: -96.751687}; // 9
    const cafeteria = {lat: 16.996026, lng: -96.751695}; // 10
    const garden = {lat: 16.996009, lng: -96.752098}; // 11
    const central_plaza = {lat: 16.995957, lng: -96.752463}; // 12
    const cafeteria_parking_lot = {lat: 16.995651, lng: -96.751792}; // 13
    const multisport_field = {lat: 16.994938, lng: -96.751860}; // 14
    const soccer_field = {lat: 16.995094, lng: -96.752524}; // 15
    const fast_soccer_field = {lat: 16.995340, lng: -96.753080}; // 16
    const gym = {lat: 16.994953, lng: -96.753122}; // 17
    const engineering_parking_lot = {lat: 16.996799, lng: -96.753219}; // 18
    const motorcycle_lot = {lat: 16.995658, lng: -96.752453}; // 19

    // starting and ending nodes
    let starting_node = 0;
    let final_node = 14;

    // adjacency list
    const adjacencyList = [
    [18, 1, 4], // F_building
    [0, 2], // cuckoo_box
    [1, 3], // dely_full
    [2, 4], // C_building
    [0, 3, 5, 12], // west_path
    [6, 4, 7], // roundabout
    [5, 18], // police_booth
    [5, 8, 11], // chess_board
    [7, 9], // A_building
    [8, 10], // B_building
    [9, 11, 13], // cafeteria
    [7, 10, 12], // garden
    [4, 11, 19], // central_plaza
    [10, 14, 19], // cafeteria_parking_lot
    [13, 15], // multisport_field
    [14, 19, 16, 17], // soccer_field
    [15, 17, 19], // fast_soccer_field
    [16, 15], // gym
    [6, 0], // engineering_parking_lot
    [12, 13, 15, 16] // motorcycle_lot
    ];

    // array that relates the int numbers with nodes
    const locations = [
    F_building,
    cuckoo_box,
    dely_full,
    C_building,
    west_path,
    roundabout,
    police_booth,
    chess_board,
    A_building,
    B_building,
    cafeteria,
    garden,
    central_plaza,
    cafeteria_parking_lot,
    multisport_field,
    soccer_field,
    fast_soccer_field,
    gym,
    engineering_parking_lot,
    motorcycle_lot
    ];

    // predecesor array
    let predecessor;

    function dijkstra(startingNode) {
    // Initialize values
    let visited = new Array(adjacencyList.length).fill(false);
    predecessor = new Array(adjacencyList.length).fill(null);
    let distance = new Array(adjacencyList.length).fill(Infinity);
    distance[startingNode] = 0;

    // js structures are made on arrays
    let queue = [];
    queue.push({ node: startingNode, cost: 0 });

    while (queue.length > 0) {
        // Extract sorted element, just left here in case we want to add costs to our jumps
        queue.sort((a, b) => a.cost - b.cost);
        const { node, cost } = queue.shift();

        // Skip if the node has already been visited
        if (visited[node]) continue;

        // Mark the current node as visited
        visited[node] = true;

        // Iterate through the neighbors of the current node
        for (const neighbor of adjacencyList[node]) {
        // Calculate the new distance from the actual node
        const newDistance = distance[node] + 1;

        // Update the distance and predecessor if the new distance is smaller
        if (newDistance < distance[neighbor]) {
            distance[neighbor] = newDistance;
            predecessor[neighbor] = node;

            // Add the neighbor to the priority queue with the updated cost
            queue.push({ node: neighbor, cost: newDistance });
        }
        }
    }
    }

    function printRoute(node) {
    dijkstra(starting_node);

    let route = []; // stack used to inverse route order

    while (predecessor[node] != null) {
        route.push(locations[node]);
        node = predecessor[node];
    }
    route.push(locations[node]);
    return route;
    }

    function iniciarMap(){
        var coord = {lat:16.9956106 ,lng: -96.7527389};
        var coordCafeteria = {lat:16.99601 ,lng: -96.75136};
        var coordIngenieria = {lat: 16.996547, lng: -96.753338};
        var coordGym = {lat: 16.994731, lng: -96.753082};
        var coordMed = {lat: 16.995969, lng: -96.753193};
        var coordBasquet = {lat: 16.994806, lng: -96.751965};
        var coordFutbol = {lat: 16.99461, lng: -96.75249};
        var coordBiblioteca = {lat: 16.996225, lng: -96.753277};
        var coordA = {lat: 16.99659, lng:-96.75199006422191};
        var coordB = {lat: 16.99629322285019, lnag: -96.75175201817626};

        var map = new google.maps.Map(document.getElementById('map'),{
            zoom: 18,
            center: coord,
            draggable: true, //desplazar en el mapa
            minZoom: 18,
            streetViewControl: false, //Quitar muñequito de google
            fullscreenControl: false, //quitar la opcion de pantalla completa
            mapTypeControl: false, //quitar la opcion de satelite
            styles: [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }]}] //Quitar los marcadores de google
        });

        var marker = new google.maps.Marker({
            position: coord,
            map: map
        });

        var iconoA = {
            url: 'A.png',
            scaledSize: new google.maps.Size(50, 50)
        };
        var markerA = new google.maps.Marker({
            position: coordA,
            map: map,
            icon: iconoA
        });
        var infoWindowA = new google.maps.InfoWindow({
        content: "Edificio A-Edith Stein: <br> Salones de uso comun: Piso 1 y 2 <br> Gastronomia: Piso 3"
        });
        // Add a click event listener to the marker
        markerA.addListener("click", function() {
            infoWindowA.open(map, markerA); // Open the info window when marker is clicked
        });

        var iconoB = {
            url: 'B.png',
            scaledSize: new google.maps.Size(50,50)
        };
        var markerB  =new google.maps.Marker({
            position: coordB,
            map: map,
            icon: iconoB
        });


        var iconoCafeteria = {
            url: 'logo2.png',
            scaledSize: new google.maps.Size(50, 50)
        };

        var markerCafeteria = new google.maps.Marker({
            position: coordCafeteria,
            map: map,
            icon: iconoCafeteria
        });
        var infoWindowCafeteria = new google.maps.InfoWindow({
            content: "Cuckoo <br> Horario: <br> Lun-Vie 8:00-19:00. <br> Sab 8:00-13:30 <br> 4,9 ⭐⭐⭐⭐⭐"
        });
        // Add a click event listener to the marker
        markerCafeteria.addListener("click", function() {
            infoWindowCafeteria.open(map, markerCafeteria); // Open the info window when marker is clicked
        });



        var iconoIngenieria = {
            url: 'logoInge.png',
            scaledSize: new google.maps.Size(50, 50)
        };

        var markerIngenieria = new google.maps.Marker({
            position: coordIngenieria,
            map: map,
            icon: iconoIngenieria
        });
        var infoWindow = new google.maps.InfoWindow({
            content: "This is the pop-up window content." // Replace with your desired content
        });
        // Add a click event listener to the marker
        markerIngenieria.addListener("click", function() {
            infoWindow.open(map, markerIngenieria); // Open the info window when marker is clicked
        });

        var iconoGym = {
            url: 'logoGym.png',
            scaledSize: new google.maps.Size(50, 50)
        };

        var markerGym = new google.maps.Marker({
            position: coordGym,
            map: map,
            icon: iconoGym
        });
        var infoWindow = new google.maps.InfoWindow({
            content: "This is the pop-up window content." // Replace with your desired content
        });
        // Add a click event listener to the marker
        markerGym.addListener("click", function() {
            infoWindow.open(map, markerGym); // Open the info window when marker is clicked
        });

        var iconoMedicina = {
            url: 'logoMedicina.png',
            scaledSize: new google.maps.Size(50, 50)
        };

        var markerMedicina = new google.maps.Marker({
            position: coordMed,
            map: map,
            icon: iconoMedicina
        });
        var infoWindow = new google.maps.InfoWindow({
            content: "This is the pop-up window content." // Replace with your desired content
        });
        // Add a click event listener to the marker
        markerMedicina.addListener("click", function() {
            infoWindow.open(map, markerMedicina); // Open the info window when marker is clicked
        });

        var iconoBasquet = {
            url: 'logoBasq.png',
            scaledSize: new google.maps.Size(50, 50)
        };

        var markerBasquet = new google.maps.Marker({
            position: coordBasquet,
            map: map,
            icon: iconoBasquet
        });
        var infoWindow = new google.maps.InfoWindow({
            content: "This is the pop-up window content." // Replace with your desired content
        });
        // Add a click event listener to the marker
        markerBasquet.addListener("click", function() {
            infoWindow.open(map, markerBasquet); // Open the info window when marker is clicked
        });

        var iconoFutbol = {
            url: 'futbolLogo.png',
            scaledSize: new google.maps.Size(50, 50)
        };

        var markerFutbol = new google.maps.Marker({
            position: coordFutbol,
            map: map,
            icon: iconoFutbol
        });
        var infoWindow = new google.maps.InfoWindow({
            content: "This is the pop-up window content." // Replace with your desired content
        });
        // Add a click event listener to the marker
        markerFutbol.addListener("click", function() {
            infoWindow.open(map, markerFutbol); // Open the info window when marker is clicked
        });

        var iconoBiblioteca = {
            url: 'logoBiblio.png',
            scaledSize: new google.maps.Size(50, 50)
        };

        var markerBiblioteca = new google.maps.Marker({
            position: coordBiblioteca,
            map: map,
            icon: iconoBiblioteca
        });
        var infoWindow = new google.maps.InfoWindow({
            content: "This is the pop-up window content." // Replace with your desired content
        });
        // Add a click event listener to the marker
        markerBiblioteca.addListener("click", function() {
            infoWindow.open(map, markerBiblioteca); // Open the info window when marker is clicked
        });



        var zonaUniversidadCoords = [
            {lat:16.996972,lng:-96.754344},
            {lat:16.994056,lng:-96.754328},
            {lat:16.994068,lng:-96.751822},
            {lat:16.994366,lng:-96.751643},
            {lat:16.994813,lng:-96.751289},
            {lat:16.994885,lng:-96.751265},
            {lat:16.994931,lng:-96.751254},
            {lat:16.995035,lng:-96.751238},
            {lat:16.996497,lng:-96.751119},
            {lat:16.996558,lng:-96.751119},
            {lat:16.996627,lng:-96.751139},
            {lat:16.996821,lng:-96.751268},
            {lat:16.996853,lng:-96.751283},
            {lat:16.996873,lng:-96.751297},
            {lat:16.996899,lng:-96.752458},
        ];

        /*var zonaUniversidad = new google.maps.Polygon({
            paths: zonaUniversidadCoords,
            strokeColor: '#e76800',
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: '#f38f0c',
            fillOpacity: 0.5 //0.35
        });

        zonaUniversidad.setMap(map);*/

        // Create a DirectionsService instance
        const directionsService = new google.maps.DirectionsService();

        // array that stores the path without starting and final nodes
        let inner_path = printRoute();
        inner_path.pop();
        inner_path.shift();

        // Define the directions request
        const request = {
            origin: locations[starting_node],
            destination: locations[final_node],
            waypoints: inner_path,
            travelMode: google.maps.TravelMode.WALKING,
        };

        // Make the directions request
        directionsService.route(request, function (response, status) {
            if (status === google.maps.DirectionsStatus.OK) {
                // Display the directions on the map
                const directionsRenderer = new google.maps.DirectionsRenderer();
                directionsRenderer.setMap(map);
                directionsRenderer.setDirections(response);

                // Create a Polyline for the custom route
                const waypoints = printRoute(final_node);

                const polyline = new google.maps.Polyline({
                path: waypoints,
                geodesic: true,
                strokeColor: "#FF0000",
                strokeOpacity: 1.0,
                strokeWeight: 2,
                });

                polyline.setMap(map);
            }
        });

        // Crear el marcador de la ubicación del usuario
        var marker = new google.maps.Marker({
            map: map,
            icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 10,
                fillColor: '#039be5',
                fillOpacity: 1,
                strokeColor: '#039be5',
                strokeOpacity: 1,
                strokeWeight: 1,
            },
            zIndex: 1000
        });

        // Obtener la ubicación del usuario en tiempo real
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                // Centrar el mapa en la ubicación del usuario
                map.setCenter(pos);
                // Actualizar la posición del marcador
                marker.setPosition(pos);
            }, function() {
                // Error al obtener la ubicación del usuario
                handleLocationError(true, marker, map.getCenter());
            });
        } else {
            // El navegador no soporta geolocalización
            handleLocationError(false, marker, map.getCenter());
        }




    }

    function handleLocationError(browserHasGeolocation, marker, pos) {
        // Mostrar un mensaje de error si no se puede obtener la ubicación del usuario
        var infoWindow = new google.maps.InfoWindow({map: map});
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
            'Error: No se pudo obtener tu ubicación' :
            'Error: Tu navegador no soporta geolocalización');
    }

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCGn7mLYMk_m978YH-QjDc_pb9JCWTaWH4&callback=iniciarMap"></script>
</body>
</html>
